<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Offense-Defense method — offense-defense • comperes</title>


<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script>
<!-- Bootstrap -->
<link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/united/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous" />


<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/all.min.css" integrity="sha256-nAmazAk6vS34Xqo0BSrTb+abbtFlgsFK7NKSi6o7Y78=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/v4-shims.min.css" integrity="sha256-6qHlizsOWFskGlwVOKuns+D1nB6ssZrHQrNj1wGplHc=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script>

<!-- headroom.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/headroom.min.js" integrity="sha256-DJFC1kqIhelURkuza0AvYal5RxMtpzLjFhsnVIeuk+U=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>



  <link href="../extra.css" rel="stylesheet">
  <script src="../extra.js"></script>

<meta property="og:title" content="Offense-Defense method — offense-defense" />
<meta property="og:description" content="Functions to compute rating and ranking
using Offense-Defense method." />
<meta name="twitter:card" content="summary" />




<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->



  </head>

  <body>
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">comperes</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.1.1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="../articles/methods-overview.html">Methods Overview</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/echasnovski/comperank">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Offense-Defense method</h1>
    <small class="dont-index">Source: <a href='https://github.com/echasnovski/comperank/blob/master/R/offense-defense.R'><code>R/offense-defense.R</code></a></small>
    <div class="hidden name"><code>offense-defense.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Functions to compute <a href='rating-ranking.html'>rating</a> and <a href='rating-ranking.html'>ranking</a>
using Offense-Defense method.</p>
    </div>

    <pre class="usage"><code class = "r"><span class='fu'>rate_od</span>(<span class='no'>cr_data</span>, <span class='no'>...</span>, <span class='kw'>force_nonneg_h2h</span> <span class='kw'>=</span> <span class='fl'>TRUE</span>, <span class='kw'>eps</span> <span class='kw'>=</span> <span class='fl'>0.001</span>, <span class='kw'>tol</span> <span class='kw'>=</span> <span class='fl'>1e-04</span>,
  <span class='kw'>max_iterations</span> <span class='kw'>=</span> <span class='fl'>100</span>)

<span class='fu'>rank_od</span>(<span class='no'>cr_data</span>, <span class='no'>...</span>, <span class='kw'>force_nonneg_h2h</span> <span class='kw'>=</span> <span class='fl'>TRUE</span>, <span class='kw'>eps</span> <span class='kw'>=</span> <span class='fl'>0.001</span>, <span class='kw'>tol</span> <span class='kw'>=</span> <span class='fl'>1e-04</span>,
  <span class='kw'>max_iterations</span> <span class='kw'>=</span> <span class='fl'>100</span>, <span class='kw'>keep_rating</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>, <span class='kw'>ties</span> <span class='kw'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='st'>"average"</span>, <span class='st'>"first"</span>,
  <span class='st'>"last"</span>, <span class='st'>"random"</span>, <span class='st'>"max"</span>, <span class='st'>"min"</span>), <span class='kw'>round_digits</span> <span class='kw'>=</span> <span class='fl'>7</span>)</code></pre>

    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>cr_data</th>
      <td><p>Competition results in format ready for
<a href='https://rdrr.io/pkg/comperes/man/longcr.html'>as_longcr()</a>.</p></td>
    </tr>
    <tr>
      <th>...</th>
      <td><p>Head-to-Head expression (see <a href='https://rdrr.io/pkg/comperes/man/h2h_mat.html'>h2h_mat()</a>).</p></td>
    </tr>
    <tr>
      <th>force_nonneg_h2h</th>
      <td><p>Whether to force nonnegative values in Head-to-Head
matrix.</p></td>
    </tr>
    <tr>
      <th>eps</th>
      <td><p>Coefficient for total support.</p></td>
    </tr>
    <tr>
      <th>tol</th>
      <td><p>Tolerance value for iterative algorithm.</p></td>
    </tr>
    <tr>
      <th>max_iterations</th>
      <td><p>Maximum number of iterations for iterative algorithm.</p></td>
    </tr>
    <tr>
      <th>keep_rating</th>
      <td><p>Whether to keep rating columns in ranking output.</p></td>
    </tr>
    <tr>
      <th>ties</th>
      <td><p>Value for <code>ties</code> in <code><a href='round_rank.html'>round_rank()</a></code>.</p></td>
    </tr>
    <tr>
      <th>round_digits</th>
      <td><p>Value for <code>round_digits</code> in <code><a href='round_rank.html'>round_rank()</a></code>.</p></td>
    </tr>
    </table>

    <h2 class="hasAnchor" id="value"><a class="anchor" href="#value"></a>Value</h2>

    <p><code>rate_od()</code> returns a <a href='https://tibble.tidyverse.org/reference/tibble.html'>tibble</a> with the following
columns:</p><ul>
<li><p><strong>player</strong> - player identifier.</p></li>
<li><p><strong>rating_off</strong> - offensive <a href='rating-ranking.html'>rating</a> of player. <strong>Bigger
value indicates better player performance</strong>.</p></li>
<li><p><strong>rating_def</strong> - defensive rating of player. <strong>Smaller value indicates
better player performance</strong>.</p></li>
<li><p><strong>rating_od</strong> - Offense-Defense rating of player. <strong>Bigger value indicates
better player performance</strong>.</p></li>
</ul>

<p><code>rank_od()</code> returns a <code>tibble</code> of the similar structure as <code>rate_od()</code>:</p><ul>
<li><p><strong>player</strong> - player identifier.</p></li>
<li><p><strong>rating_off</strong>, <strong>rating_def</strong>, <strong>rating_od</strong> - ratings (if
<code>keep_rating = TRUE</code>).</p></li>
<li><p><strong>ranking_off</strong>, <strong>ranking_def</strong>, <strong>ranking_od</strong> -
<a href='rating-ranking.html'>rankings</a> computed with <code><a href='round_rank.html'>round_rank()</a></code>.</p></li>
</ul>

    <h2 class="hasAnchor" id="details"><a class="anchor" href="#details"></a>Details</h2>

    <p>Offense-Defense (OD) rating is designed for games in which player's
goal is to make higher score than opponent(s). To describe competition
results Head-to-Head matrix is computed using <code>...</code> (see
<a href='https://rdrr.io/pkg/comperes/man/h2h_mat.html'>h2h_mat()</a> for technical details and section <strong>Design
of Head-to-Head values</strong> for design details). For pairs of players without
common games Head-to-Head value is computed to 0 (not <code>NA</code>). <strong>Note</strong> that
values should be non-negative and non-NA. This can be ensured with setting
<code>force_nonneg_h2h</code> to <code>TRUE</code>.</p>
<p>For player which can achieve <em>high</em> Head-to-Head value (even against the
player with strong defense) it is said that he/she has <strong>strong offense</strong>
which results into <em>high</em> offensive rating. For player which can force their
opponents into achieving <em>low</em> Head-to-Head value (even if they have strong
offense) it is said that he/she has <strong>strong defense</strong> which results into
<em>low</em> defensive rating.</p>
<p>Offensive and defensive ratings describe different skills of players. In
order to fully rate players, OD ratings are computed: offensive ratings
divided by defensive. The more OD rating the better player performance.</p>
<p>Algorithm for OD ratings is as follows:</p><ol>
<li><p>Compute Head-to-Head matrix using <code>...</code>.</p></li>
<li><p>Add small value to Head-to-Head matrix to ensure convergence of the
iterative algorithm in the next step. If all values are strictly positive
then this step is omitted. In other case small value is computed as the
smallest non-zero Head-to-Head value multiplied by <code>eps</code>.</p></li>
<li><p>Perform iterative fixed point search with the following recurrent formula:
<code>def_{k+1} = t(A) %*% inv(A %*% inv(def_{k}))</code> where <code>def_{k}</code>
is a vector of defensive ratings at iteration <code>k</code>, <code>A</code> is a perturbed
Head-to-Head matrix, <code>inv(x) = 1 / x</code>. Iterative search stops if at least one
of two conditions is met:</p><ul>
<li><p><code>sum(abs(def_{k+1} / def_{k} - 1)) &lt; tol</code>.</p></li>
<li><p>Number of iterations exceeds maximum number of iterations
<code>max_iterations</code>.</p></li>
</ul></li>
<li><p>Compute offensive ratings: <code>off = A %*% inv(def)</code>.</p></li>
<li><p>Compute OD ratings: <code>od = off / def</code>.</p></li>
</ol>

<p>Ratings are computed based only on games between players of interest (see
Players). However, be careful with OD ratings for players with no games:
they will have weak offense (because they "scored" 0 in all games) but
strong defense (because all their opponents also "scored" 0 in all common
games). Therefore accounting for missing players might be not a very good
idea.</p>
    <h2 class="hasAnchor" id="design-of-head-to-head-values"><a class="anchor" href="#design-of-head-to-head-values"></a>Design of Head-to-Head values</h2>

    


<p>Head-to-Head values in these functions are assumed to follow the property
which can be <em>equivalently</em> described in two ways:</p><ul>
<li><p>In terms of <a href='https://rdrr.io/pkg/comperes/man/h2h_mat.html'>matrix format</a>: <strong>the more Head-to-Head
value in row <em>i</em> and column <em>j</em> the better player from row <em>i</em> performed than
player from column <em>j</em></strong>.</p></li>
<li><p>In terms of <a href='https://rdrr.io/pkg/comperes/man/h2h_long.html'>long format</a>: <strong>the more Head-to-Head
value the better player1 performed than player2</strong>.</p></li>
</ul>

<p>This design is chosen because in most competitions the goal is to score
<strong>more points</strong> and not less. Also it allows for more smooth use of
<a href='https://rdrr.io/pkg/comperes/man/h2h_funs.html'>h2h_funs</a> from <code>comperes</code> package.</p>
    <h2 class="hasAnchor" id="players"><a class="anchor" href="#players"></a>Players</h2>

    


<p><code>comperank</code> offers a possibility to handle certain set of players. It is done
by having <code>player</code> column (in <a href='https://rdrr.io/pkg/comperes/man/longcr.html'>longcr</a> format) as factor
with levels specifying all players of interest. In case of factor the result
is returned only for players from its levels. Otherwise - for all present
players.</p>
    <h2 class="hasAnchor" id="references"><a class="anchor" href="#references"></a>References</h2>

    <p>Amy N. Langville, Carl D. Meyer (2012) <em>Who’s #1?: The
science of rating and ranking</em>.</p>
<p>Philip A. Knight (2008) <em>The Sinkhorn-Knopp algorithm:
Convergence and applications.</em>. SIAM Journal of Matrix Analysis,
30(1):261–275, 2008 (For stopping rule of iterative algorithm).</p>

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><code class = "r"><div class='input'><span class='fu'>rate_od</span>(<span class='no'>ncaa2005</span>, <span class='fu'><a href='https://rdrr.io/r/base/mean.html'>mean</a></span>(<span class='no'>score1</span>))</div><div class='output co'>#&gt; <span style='color: #949494;'># A tibble: 5 x 4</span><span>
#&gt;   player rating_off rating_def rating_od
#&gt;   </span><span style='color: #949494;font-style: italic;'>&lt;chr&gt;</span><span>       </span><span style='color: #949494;font-style: italic;'>&lt;dbl&gt;</span><span>      </span><span style='color: #949494;font-style: italic;'>&lt;dbl&gt;</span><span>     </span><span style='color: #949494;font-style: italic;'>&lt;dbl&gt;</span><span>
#&gt; </span><span style='color: #BCBCBC;'>1</span><span> Duke         39.7      1.57       25.3
#&gt; </span><span style='color: #BCBCBC;'>2</span><span> Miami       181.       0.860     211. 
#&gt; </span><span style='color: #BCBCBC;'>3</span><span> UNC          58.1      1.15       50.6
#&gt; </span><span style='color: #BCBCBC;'>4</span><span> UVA          95.0      0.914     104. 
#&gt; </span><span style='color: #BCBCBC;'>5</span><span> VT          183.       0.532     344. </div><div class='input'>
<span class='fu'>rank_od</span>(<span class='no'>ncaa2005</span>, <span class='fu'><a href='https://rdrr.io/r/base/mean.html'>mean</a></span>(<span class='no'>score1</span>))</div><div class='output co'>#&gt; </span><span style='color: #949494;'># A tibble: 5 x 4</span><span>
#&gt;   player ranking_off ranking_def ranking_od
#&gt;   </span><span style='color: #949494;font-style: italic;'>&lt;chr&gt;</span><span>        </span><span style='color: #949494;font-style: italic;'>&lt;dbl&gt;</span><span>       </span><span style='color: #949494;font-style: italic;'>&lt;dbl&gt;</span><span>      </span><span style='color: #949494;font-style: italic;'>&lt;dbl&gt;</span><span>
#&gt; </span><span style='color: #BCBCBC;'>1</span><span> Duke             5           5          5
#&gt; </span><span style='color: #BCBCBC;'>2</span><span> Miami            2           2          2
#&gt; </span><span style='color: #BCBCBC;'>3</span><span> UNC              4           4          4
#&gt; </span><span style='color: #BCBCBC;'>4</span><span> UVA              3           3          3
#&gt; </span><span style='color: #BCBCBC;'>5</span><span> VT               1           1          1</div><div class='input'>
<span class='fu'>rank_od</span>(<span class='no'>ncaa2005</span>, <span class='fu'><a href='https://rdrr.io/r/base/mean.html'>mean</a></span>(<span class='no'>score1</span>), <span class='kw'>keep_rating</span> <span class='kw'>=</span> <span class='fl'>TRUE</span>)</div><div class='output co'>#&gt; </span><span style='color: #949494;'># A tibble: 5 x 7</span><span>
#&gt;   player rating_off rating_def rating_od ranking_off ranking_def ranking_od
#&gt;   </span><span style='color: #949494;font-style: italic;'>&lt;chr&gt;</span><span>       </span><span style='color: #949494;font-style: italic;'>&lt;dbl&gt;</span><span>      </span><span style='color: #949494;font-style: italic;'>&lt;dbl&gt;</span><span>     </span><span style='color: #949494;font-style: italic;'>&lt;dbl&gt;</span><span>       </span><span style='color: #949494;font-style: italic;'>&lt;dbl&gt;</span><span>       </span><span style='color: #949494;font-style: italic;'>&lt;dbl&gt;</span><span>      </span><span style='color: #949494;font-style: italic;'>&lt;dbl&gt;</span><span>
#&gt; </span><span style='color: #BCBCBC;'>1</span><span> Duke         39.7      1.57       25.3           5           5          5
#&gt; </span><span style='color: #BCBCBC;'>2</span><span> Miami       181.       0.860     211.            2           2          2
#&gt; </span><span style='color: #BCBCBC;'>3</span><span> UNC          58.1      1.15       50.6           4           4          4
#&gt; </span><span style='color: #BCBCBC;'>4</span><span> UVA          95.0      0.914     104.            3           3          3
#&gt; </span><span style='color: #BCBCBC;'>5</span><span> VT          183.       0.532     344.            1           1          1</div><div class='input'>
<span class='co'># Account for self play</span>
<span class='fu'>rate_od</span>(<span class='no'>ncaa2005</span>, <span class='kw'>if</span>(<span class='no'>player1</span>[<span class='fl'>1</span>] <span class='kw'>==</span> <span class='no'>player2</span>[<span class='fl'>1</span>]) <span class='fl'>0</span> <span class='kw'>else</span> <span class='fu'><a href='https://rdrr.io/r/base/mean.html'>mean</a></span>(<span class='no'>score1</span>))</div><div class='output co'>#&gt; </span><span style='color: #949494;'># A tibble: 5 x 4</span><span>
#&gt;   player rating_off rating_def rating_od
#&gt;   </span><span style='color: #949494;font-style: italic;'>&lt;chr&gt;</span><span>       </span><span style='color: #949494;font-style: italic;'>&lt;dbl&gt;</span><span>      </span><span style='color: #949494;font-style: italic;'>&lt;dbl&gt;</span><span>     </span><span style='color: #949494;font-style: italic;'>&lt;dbl&gt;</span><span>
#&gt; </span><span style='color: #BCBCBC;'>1</span><span> Duke         34.0      1.69       20.1
#&gt; </span><span style='color: #BCBCBC;'>2</span><span> Miami       152.       0.803     189. 
#&gt; </span><span style='color: #BCBCBC;'>3</span><span> UNC          48.7      1.16       41.8
#&gt; </span><span style='color: #BCBCBC;'>4</span><span> UVA          82.0      0.967      84.8
#&gt; </span><span style='color: #BCBCBC;'>5</span><span> VT          115.       0.411     280. </div><div class='input'>
</div></span></code></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
    <h2>Contents</h2>
    <ul class="nav nav-pills nav-stacked">
      <li><a href="#arguments">Arguments</a></li>
      <li><a href="#value">Value</a></li>
      <li><a href="#details">Details</a></li>
      <li><a href="#design-of-head-to-head-values">Design of Head-to-Head values</a></li>
      <li><a href="#players">Players</a></li>
      <li><a href="#references">References</a></li>
      <li><a href="#examples">Examples</a></li>
    </ul>

  </div>
</div>


      <footer>
      <div class="copyright">
  <p>Developed by Evgeni Chasnovski.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.4.1.</p>
</div>

      </footer>
   </div>

  


  </body>
</html>


